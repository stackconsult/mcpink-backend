// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: githubcreds.sql

package githubcreds

import (
	"context"

	"github.com/jackc/pgx/v5/pgtype"
)

const clearGitHubAppInstallation = `-- name: ClearGitHubAppInstallation :one
UPDATE github_creds
SET github_app_installation_id = NULL,
    updated_at = NOW()
WHERE user_id = $1
RETURNING id, user_id, github_id, github_oauth_token, github_oauth_scopes, github_oauth_updated_at, github_app_installation_id, created_at, updated_at
`

func (q *Queries) ClearGitHubAppInstallation(ctx context.Context, userID string) (GithubCred, error) {
	row := q.db.QueryRow(ctx, clearGitHubAppInstallation, userID)
	var i GithubCred
	err := row.Scan(
		&i.ID,
		&i.UserID,
		&i.GithubID,
		&i.GithubOauthToken,
		&i.GithubOauthScopes,
		&i.GithubOauthUpdatedAt,
		&i.GithubAppInstallationID,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const createGitHubCreds = `-- name: CreateGitHubCreds :one
INSERT INTO github_creds (user_id, github_id, github_oauth_token, github_oauth_scopes, github_app_installation_id)
VALUES ($1, $2, $3, $4, $5)
RETURNING id, user_id, github_id, github_oauth_token, github_oauth_scopes, github_oauth_updated_at, github_app_installation_id, created_at, updated_at
`

type CreateGitHubCredsParams struct {
	UserID                  string   `json:"user_id"`
	GithubID                int64    `json:"github_id"`
	GithubOauthToken        string   `json:"github_oauth_token"`
	GithubOauthScopes       []string `json:"github_oauth_scopes"`
	GithubAppInstallationID *int64   `json:"github_app_installation_id"`
}

func (q *Queries) CreateGitHubCreds(ctx context.Context, arg CreateGitHubCredsParams) (GithubCred, error) {
	row := q.db.QueryRow(ctx, createGitHubCreds,
		arg.UserID,
		arg.GithubID,
		arg.GithubOauthToken,
		arg.GithubOauthScopes,
		arg.GithubAppInstallationID,
	)
	var i GithubCred
	err := row.Scan(
		&i.ID,
		&i.UserID,
		&i.GithubID,
		&i.GithubOauthToken,
		&i.GithubOauthScopes,
		&i.GithubOauthUpdatedAt,
		&i.GithubAppInstallationID,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const getGitHubCredsByGitHubID = `-- name: GetGitHubCredsByGitHubID :one
SELECT id, user_id, github_id, github_oauth_token, github_oauth_scopes, github_oauth_updated_at, github_app_installation_id, created_at, updated_at FROM github_creds WHERE github_id = $1
`

func (q *Queries) GetGitHubCredsByGitHubID(ctx context.Context, githubID int64) (GithubCred, error) {
	row := q.db.QueryRow(ctx, getGitHubCredsByGitHubID, githubID)
	var i GithubCred
	err := row.Scan(
		&i.ID,
		&i.UserID,
		&i.GithubID,
		&i.GithubOauthToken,
		&i.GithubOauthScopes,
		&i.GithubOauthUpdatedAt,
		&i.GithubAppInstallationID,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const getGitHubCredsByUserID = `-- name: GetGitHubCredsByUserID :one
SELECT id, user_id, github_id, github_oauth_token, github_oauth_scopes, github_oauth_updated_at, github_app_installation_id, created_at, updated_at FROM github_creds WHERE user_id = $1
`

func (q *Queries) GetGitHubCredsByUserID(ctx context.Context, userID string) (GithubCred, error) {
	row := q.db.QueryRow(ctx, getGitHubCredsByUserID, userID)
	var i GithubCred
	err := row.Scan(
		&i.ID,
		&i.UserID,
		&i.GithubID,
		&i.GithubOauthToken,
		&i.GithubOauthScopes,
		&i.GithubOauthUpdatedAt,
		&i.GithubAppInstallationID,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const getUserWithGitHubCreds = `-- name: GetUserWithGitHubCreds :one
SELECT
    u.id,
    u.github_id,
    u.github_username,
    u.avatar_url,
    u.coolify_github_app_uuid,
    u.created_at,
    u.updated_at,
    gc.github_oauth_token,
    gc.github_oauth_scopes,
    gc.github_oauth_updated_at,
    gc.github_app_installation_id
FROM users u
JOIN github_creds gc ON u.id = gc.user_id
WHERE u.id = $1
`

type GetUserWithGitHubCredsRow struct {
	ID                      string             `json:"id"`
	GithubID                int64              `json:"github_id"`
	GithubUsername          string             `json:"github_username"`
	AvatarUrl               *string            `json:"avatar_url"`
	CoolifyGithubAppUuid    *string            `json:"coolify_github_app_uuid"`
	CreatedAt               pgtype.Timestamptz `json:"created_at"`
	UpdatedAt               pgtype.Timestamptz `json:"updated_at"`
	GithubOauthToken        string             `json:"github_oauth_token"`
	GithubOauthScopes       []string           `json:"github_oauth_scopes"`
	GithubOauthUpdatedAt    pgtype.Timestamptz `json:"github_oauth_updated_at"`
	GithubAppInstallationID *int64             `json:"github_app_installation_id"`
}

func (q *Queries) GetUserWithGitHubCreds(ctx context.Context, id string) (GetUserWithGitHubCredsRow, error) {
	row := q.db.QueryRow(ctx, getUserWithGitHubCreds, id)
	var i GetUserWithGitHubCredsRow
	err := row.Scan(
		&i.ID,
		&i.GithubID,
		&i.GithubUsername,
		&i.AvatarUrl,
		&i.CoolifyGithubAppUuid,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.GithubOauthToken,
		&i.GithubOauthScopes,
		&i.GithubOauthUpdatedAt,
		&i.GithubAppInstallationID,
	)
	return i, err
}

const setGitHubAppInstallation = `-- name: SetGitHubAppInstallation :one
UPDATE github_creds
SET github_app_installation_id = $2,
    updated_at = NOW()
WHERE user_id = $1
RETURNING id, user_id, github_id, github_oauth_token, github_oauth_scopes, github_oauth_updated_at, github_app_installation_id, created_at, updated_at
`

type SetGitHubAppInstallationParams struct {
	UserID                  string `json:"user_id"`
	GithubAppInstallationID *int64 `json:"github_app_installation_id"`
}

func (q *Queries) SetGitHubAppInstallation(ctx context.Context, arg SetGitHubAppInstallationParams) (GithubCred, error) {
	row := q.db.QueryRow(ctx, setGitHubAppInstallation, arg.UserID, arg.GithubAppInstallationID)
	var i GithubCred
	err := row.Scan(
		&i.ID,
		&i.UserID,
		&i.GithubID,
		&i.GithubOauthToken,
		&i.GithubOauthScopes,
		&i.GithubOauthUpdatedAt,
		&i.GithubAppInstallationID,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const updateGitHubOAuthToken = `-- name: UpdateGitHubOAuthToken :one
UPDATE github_creds
SET github_oauth_token = $2,
    github_oauth_scopes = $3,
    github_oauth_updated_at = NOW(),
    updated_at = NOW()
WHERE user_id = $1
RETURNING id, user_id, github_id, github_oauth_token, github_oauth_scopes, github_oauth_updated_at, github_app_installation_id, created_at, updated_at
`

type UpdateGitHubOAuthTokenParams struct {
	UserID            string   `json:"user_id"`
	GithubOauthToken  string   `json:"github_oauth_token"`
	GithubOauthScopes []string `json:"github_oauth_scopes"`
}

func (q *Queries) UpdateGitHubOAuthToken(ctx context.Context, arg UpdateGitHubOAuthTokenParams) (GithubCred, error) {
	row := q.db.QueryRow(ctx, updateGitHubOAuthToken, arg.UserID, arg.GithubOauthToken, arg.GithubOauthScopes)
	var i GithubCred
	err := row.Scan(
		&i.ID,
		&i.UserID,
		&i.GithubID,
		&i.GithubOauthToken,
		&i.GithubOauthScopes,
		&i.GithubOauthUpdatedAt,
		&i.GithubAppInstallationID,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}
