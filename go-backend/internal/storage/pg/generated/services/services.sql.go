// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: services.sql

package services

import (
	"context"
)

const countServicesByUserID = `-- name: CountServicesByUserID :one
SELECT COUNT(*) FROM services WHERE user_id = $1
`

func (q *Queries) CountServicesByUserID(ctx context.Context, userID string) (int64, error) {
	row := q.db.QueryRow(ctx, countServicesByUserID, userID)
	var count int64
	err := row.Scan(&count)
	return count, err
}

const createService = `-- name: CreateService :one
INSERT INTO services (
    user_id, repo, branch, server_uuid, name, build_pack, port, env_vars, workflow_id, build_status
) VALUES (
    $1, $2, $3, $4, $5, $6, $7, $8, $9, 'queued'
)
RETURNING id, user_id, coolify_app_uuid, build_status, runtime_status, error_message, repo, branch, server_uuid, name, build_pack, port, env_vars, fqdn, workflow_id, workflow_run_id, created_at, updated_at
`

type CreateServiceParams struct {
	UserID     string  `json:"user_id"`
	Repo       string  `json:"repo"`
	Branch     string  `json:"branch"`
	ServerUuid string  `json:"server_uuid"`
	Name       *string `json:"name"`
	BuildPack  string  `json:"build_pack"`
	Port       string  `json:"port"`
	EnvVars    []byte  `json:"env_vars"`
	WorkflowID string  `json:"workflow_id"`
}

func (q *Queries) CreateService(ctx context.Context, arg CreateServiceParams) (Service, error) {
	row := q.db.QueryRow(ctx, createService,
		arg.UserID,
		arg.Repo,
		arg.Branch,
		arg.ServerUuid,
		arg.Name,
		arg.BuildPack,
		arg.Port,
		arg.EnvVars,
		arg.WorkflowID,
	)
	var i Service
	err := row.Scan(
		&i.ID,
		&i.UserID,
		&i.CoolifyAppUuid,
		&i.BuildStatus,
		&i.RuntimeStatus,
		&i.ErrorMessage,
		&i.Repo,
		&i.Branch,
		&i.ServerUuid,
		&i.Name,
		&i.BuildPack,
		&i.Port,
		&i.EnvVars,
		&i.Fqdn,
		&i.WorkflowID,
		&i.WorkflowRunID,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const deleteService = `-- name: DeleteService :exec
DELETE FROM services WHERE id = $1
`

func (q *Queries) DeleteService(ctx context.Context, id string) error {
	_, err := q.db.Exec(ctx, deleteService, id)
	return err
}

const getServiceByCoolifyUUID = `-- name: GetServiceByCoolifyUUID :one
SELECT id, user_id, coolify_app_uuid, build_status, runtime_status, error_message, repo, branch, server_uuid, name, build_pack, port, env_vars, fqdn, workflow_id, workflow_run_id, created_at, updated_at FROM services WHERE coolify_app_uuid = $1
`

func (q *Queries) GetServiceByCoolifyUUID(ctx context.Context, coolifyAppUuid *string) (Service, error) {
	row := q.db.QueryRow(ctx, getServiceByCoolifyUUID, coolifyAppUuid)
	var i Service
	err := row.Scan(
		&i.ID,
		&i.UserID,
		&i.CoolifyAppUuid,
		&i.BuildStatus,
		&i.RuntimeStatus,
		&i.ErrorMessage,
		&i.Repo,
		&i.Branch,
		&i.ServerUuid,
		&i.Name,
		&i.BuildPack,
		&i.Port,
		&i.EnvVars,
		&i.Fqdn,
		&i.WorkflowID,
		&i.WorkflowRunID,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const getServiceByID = `-- name: GetServiceByID :one
SELECT id, user_id, coolify_app_uuid, build_status, runtime_status, error_message, repo, branch, server_uuid, name, build_pack, port, env_vars, fqdn, workflow_id, workflow_run_id, created_at, updated_at FROM services WHERE id = $1
`

func (q *Queries) GetServiceByID(ctx context.Context, id string) (Service, error) {
	row := q.db.QueryRow(ctx, getServiceByID, id)
	var i Service
	err := row.Scan(
		&i.ID,
		&i.UserID,
		&i.CoolifyAppUuid,
		&i.BuildStatus,
		&i.RuntimeStatus,
		&i.ErrorMessage,
		&i.Repo,
		&i.Branch,
		&i.ServerUuid,
		&i.Name,
		&i.BuildPack,
		&i.Port,
		&i.EnvVars,
		&i.Fqdn,
		&i.WorkflowID,
		&i.WorkflowRunID,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const getServiceByWorkflowID = `-- name: GetServiceByWorkflowID :one
SELECT id, user_id, coolify_app_uuid, build_status, runtime_status, error_message, repo, branch, server_uuid, name, build_pack, port, env_vars, fqdn, workflow_id, workflow_run_id, created_at, updated_at FROM services WHERE workflow_id = $1
`

func (q *Queries) GetServiceByWorkflowID(ctx context.Context, workflowID string) (Service, error) {
	row := q.db.QueryRow(ctx, getServiceByWorkflowID, workflowID)
	var i Service
	err := row.Scan(
		&i.ID,
		&i.UserID,
		&i.CoolifyAppUuid,
		&i.BuildStatus,
		&i.RuntimeStatus,
		&i.ErrorMessage,
		&i.Repo,
		&i.Branch,
		&i.ServerUuid,
		&i.Name,
		&i.BuildPack,
		&i.Port,
		&i.EnvVars,
		&i.Fqdn,
		&i.WorkflowID,
		&i.WorkflowRunID,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const listServicesByUserID = `-- name: ListServicesByUserID :many
SELECT id, user_id, coolify_app_uuid, build_status, runtime_status, error_message, repo, branch, server_uuid, name, build_pack, port, env_vars, fqdn, workflow_id, workflow_run_id, created_at, updated_at FROM services
WHERE user_id = $1
ORDER BY created_at DESC
LIMIT $2 OFFSET $3
`

type ListServicesByUserIDParams struct {
	UserID string `json:"user_id"`
	Limit  int32  `json:"limit"`
	Offset int32  `json:"offset"`
}

func (q *Queries) ListServicesByUserID(ctx context.Context, arg ListServicesByUserIDParams) ([]Service, error) {
	rows, err := q.db.Query(ctx, listServicesByUserID, arg.UserID, arg.Limit, arg.Offset)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []Service{}
	for rows.Next() {
		var i Service
		if err := rows.Scan(
			&i.ID,
			&i.UserID,
			&i.CoolifyAppUuid,
			&i.BuildStatus,
			&i.RuntimeStatus,
			&i.ErrorMessage,
			&i.Repo,
			&i.Branch,
			&i.ServerUuid,
			&i.Name,
			&i.BuildPack,
			&i.Port,
			&i.EnvVars,
			&i.Fqdn,
			&i.WorkflowID,
			&i.WorkflowRunID,
			&i.CreatedAt,
			&i.UpdatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const updateBuildStatus = `-- name: UpdateBuildStatus :one
UPDATE services
SET build_status = $2, updated_at = NOW()
WHERE id = $1
RETURNING id, user_id, coolify_app_uuid, build_status, runtime_status, error_message, repo, branch, server_uuid, name, build_pack, port, env_vars, fqdn, workflow_id, workflow_run_id, created_at, updated_at
`

type UpdateBuildStatusParams struct {
	ID          string `json:"id"`
	BuildStatus string `json:"build_status"`
}

func (q *Queries) UpdateBuildStatus(ctx context.Context, arg UpdateBuildStatusParams) (Service, error) {
	row := q.db.QueryRow(ctx, updateBuildStatus, arg.ID, arg.BuildStatus)
	var i Service
	err := row.Scan(
		&i.ID,
		&i.UserID,
		&i.CoolifyAppUuid,
		&i.BuildStatus,
		&i.RuntimeStatus,
		&i.ErrorMessage,
		&i.Repo,
		&i.Branch,
		&i.ServerUuid,
		&i.Name,
		&i.BuildPack,
		&i.Port,
		&i.EnvVars,
		&i.Fqdn,
		&i.WorkflowID,
		&i.WorkflowRunID,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const updateRuntimeStatus = `-- name: UpdateRuntimeStatus :one
UPDATE services
SET runtime_status = $2, updated_at = NOW()
WHERE id = $1
RETURNING id, user_id, coolify_app_uuid, build_status, runtime_status, error_message, repo, branch, server_uuid, name, build_pack, port, env_vars, fqdn, workflow_id, workflow_run_id, created_at, updated_at
`

type UpdateRuntimeStatusParams struct {
	ID            string  `json:"id"`
	RuntimeStatus *string `json:"runtime_status"`
}

func (q *Queries) UpdateRuntimeStatus(ctx context.Context, arg UpdateRuntimeStatusParams) (Service, error) {
	row := q.db.QueryRow(ctx, updateRuntimeStatus, arg.ID, arg.RuntimeStatus)
	var i Service
	err := row.Scan(
		&i.ID,
		&i.UserID,
		&i.CoolifyAppUuid,
		&i.BuildStatus,
		&i.RuntimeStatus,
		&i.ErrorMessage,
		&i.Repo,
		&i.Branch,
		&i.ServerUuid,
		&i.Name,
		&i.BuildPack,
		&i.Port,
		&i.EnvVars,
		&i.Fqdn,
		&i.WorkflowID,
		&i.WorkflowRunID,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const updateServiceCoolifyApp = `-- name: UpdateServiceCoolifyApp :one
UPDATE services
SET coolify_app_uuid = $2, build_status = 'building', updated_at = NOW()
WHERE id = $1
RETURNING id, user_id, coolify_app_uuid, build_status, runtime_status, error_message, repo, branch, server_uuid, name, build_pack, port, env_vars, fqdn, workflow_id, workflow_run_id, created_at, updated_at
`

type UpdateServiceCoolifyAppParams struct {
	ID             string  `json:"id"`
	CoolifyAppUuid *string `json:"coolify_app_uuid"`
}

func (q *Queries) UpdateServiceCoolifyApp(ctx context.Context, arg UpdateServiceCoolifyAppParams) (Service, error) {
	row := q.db.QueryRow(ctx, updateServiceCoolifyApp, arg.ID, arg.CoolifyAppUuid)
	var i Service
	err := row.Scan(
		&i.ID,
		&i.UserID,
		&i.CoolifyAppUuid,
		&i.BuildStatus,
		&i.RuntimeStatus,
		&i.ErrorMessage,
		&i.Repo,
		&i.Branch,
		&i.ServerUuid,
		&i.Name,
		&i.BuildPack,
		&i.Port,
		&i.EnvVars,
		&i.Fqdn,
		&i.WorkflowID,
		&i.WorkflowRunID,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const updateServiceFailed = `-- name: UpdateServiceFailed :one
UPDATE services
SET build_status = 'failed', error_message = $2, updated_at = NOW()
WHERE id = $1
RETURNING id, user_id, coolify_app_uuid, build_status, runtime_status, error_message, repo, branch, server_uuid, name, build_pack, port, env_vars, fqdn, workflow_id, workflow_run_id, created_at, updated_at
`

type UpdateServiceFailedParams struct {
	ID           string  `json:"id"`
	ErrorMessage *string `json:"error_message"`
}

func (q *Queries) UpdateServiceFailed(ctx context.Context, arg UpdateServiceFailedParams) (Service, error) {
	row := q.db.QueryRow(ctx, updateServiceFailed, arg.ID, arg.ErrorMessage)
	var i Service
	err := row.Scan(
		&i.ID,
		&i.UserID,
		&i.CoolifyAppUuid,
		&i.BuildStatus,
		&i.RuntimeStatus,
		&i.ErrorMessage,
		&i.Repo,
		&i.Branch,
		&i.ServerUuid,
		&i.Name,
		&i.BuildPack,
		&i.Port,
		&i.EnvVars,
		&i.Fqdn,
		&i.WorkflowID,
		&i.WorkflowRunID,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const updateServiceRunning = `-- name: UpdateServiceRunning :one
UPDATE services
SET build_status = 'success', runtime_status = 'running', fqdn = $2, updated_at = NOW()
WHERE id = $1
RETURNING id, user_id, coolify_app_uuid, build_status, runtime_status, error_message, repo, branch, server_uuid, name, build_pack, port, env_vars, fqdn, workflow_id, workflow_run_id, created_at, updated_at
`

type UpdateServiceRunningParams struct {
	ID   string  `json:"id"`
	Fqdn *string `json:"fqdn"`
}

func (q *Queries) UpdateServiceRunning(ctx context.Context, arg UpdateServiceRunningParams) (Service, error) {
	row := q.db.QueryRow(ctx, updateServiceRunning, arg.ID, arg.Fqdn)
	var i Service
	err := row.Scan(
		&i.ID,
		&i.UserID,
		&i.CoolifyAppUuid,
		&i.BuildStatus,
		&i.RuntimeStatus,
		&i.ErrorMessage,
		&i.Repo,
		&i.Branch,
		&i.ServerUuid,
		&i.Name,
		&i.BuildPack,
		&i.Port,
		&i.EnvVars,
		&i.Fqdn,
		&i.WorkflowID,
		&i.WorkflowRunID,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const updateWorkflowRunID = `-- name: UpdateWorkflowRunID :exec
UPDATE services
SET workflow_run_id = $2, updated_at = NOW()
WHERE id = $1
`

type UpdateWorkflowRunIDParams struct {
	ID            string  `json:"id"`
	WorkflowRunID *string `json:"workflow_run_id"`
}

func (q *Queries) UpdateWorkflowRunID(ctx context.Context, arg UpdateWorkflowRunIDParams) error {
	_, err := q.db.Exec(ctx, updateWorkflowRunID, arg.ID, arg.WorkflowRunID)
	return err
}
