---
# Cluster-specific paths (resolved relative to inventory_dir)
k8s_manifest_src_dir: "{{ inventory_dir }}/../k8s"
ansible_ssh_extra_args: "-o UserKnownHostsFile={{ inventory_dir }}/../known_hosts -o GlobalKnownHostsFile=/dev/null -o UpdateHostKeys=no"

# Shared cluster defaults
k3s_server_url: "https://{{ k3s_server_endpoint_ip }}:6443"
k3s_flannel_iface_default: enp7s0
k3s_extra_tls_sans: []
k3s_disable_default_registry_endpoint: true
k3s_server_disable_components:
  - traefik
  - servicelb

# Pod network CIDRs (explicit — k3s defaults are 10.42/10.43 but we set them for visibility)
k3s_cluster_cidr: "10.42.0.0/16"
k3s_service_cidr: "10.43.0.0/16"

# Controller-manager tuning for density
# node-cidr-mask-size=22: gives each node 1022 pod IPs (vs 254 at default /24)
#   — /16 cluster CIDR / /22 per node = 64 nodes max (sufficient; cluster sharding at ~30 nodes)
# node-monitor-grace-period=20s: faster failure detection (default 40s)
# NOTE: pod-eviction-timeout was removed in K8s 1.26+; eviction is now handled by
#   the node lifecycle controller's default behavior (no flag needed)
k3s_kube_controller_manager_args:
  - "node-cidr-mask-size=22"
  - "node-monitor-grace-period=20s"

registry_mirror_endpoint: "http://{{ registry_ip }}:{{ registry_port }}"
registry_host_fqdn: "{{ registry_host_alias }}:{{ registry_port }}"

# Firewall defaults
firewall_block_smtp: true
firewall_block_metadata: true

# Helm CLI pin (reproducible controller bootstrap)
helm_cli_version: "3.16.4"
helm_cli_arch_map:
  x86_64: amd64
  aarch64: arm64
helm_cli_sha256:
  amd64: fc307327959aa38ed8f9f7e66d45492bb022a66c3e5da6063958254b9767d179
  arm64: d3f8f15b3d9ec8c8678fbf3280c3e5902efabe5912e2f9fcf29107efbc8ead69

# Helm chart versions (pin where practical)
traefik_chart_ref: traefik/traefik
cert_manager_chart_ref: jetstack/cert-manager
loki_chart_ref: grafana/loki
promtail_chart_ref: grafana/promtail
prometheus_chart_ref: prometheus-community/kube-prometheus-stack
grafana_chart_ref: grafana/grafana
traefik_chart_version: "39.0.0"
cert_manager_chart_version: "v1.19.3"
loki_chart_version: "6.53.0"
promtail_chart_version: "6.17.1"
prometheus_chart_version: "81.6.1"
grafana_chart_version: "10.5.15"

# Helm release names
traefik_release_name: traefik
cert_manager_release_name: cert-manager
loki_release_name: loki
promtail_release_name: promtail
prometheus_release_name: prometheus
grafana_release_name: grafana

# Cloudflare load balancer defaults (Cloudflare dashboard is current control surface)
cloudflare_lb_hostnames:
  - "*.{{ apps_domain }}"
  - "grafana.{{ apps_domain }}"
  - "loki.{{ apps_domain }}"
  - "prometheus.{{ apps_domain }}"
cloudflare_lb_monitor_path: /
cloudflare_lb_monitor_port: 443
cloudflare_lb_monitor_expected_codes: "200,301,302,401,403,404"
cloudflare_lb_monitor_interval: 60
cloudflare_lb_monitor_timeout: 5

# Hetzner Cloud LB (custom domain traffic)
hetzner_lb_name: lb-eu-central-1
hetzner_lb_public_ip: 49.12.19.38
hetzner_lb_private_ip: 10.0.0.2
